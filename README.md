# <a name="ole_link1"></a>Практическое занятие №4
# «Расчёт параметров кэш-памяти»


|<p>№ </p><p>комбинации</p>|Объём ОЗУ (Гб)|ШД |Слов в строке |Делитель кэш|k|
| :- | :- | :- | :- | :- | :- |
|388|64|128|32|512|16|
|592|64|64|128|1024|4|

Необходимо вычислить разрядность полей (TAG, SET/INDEX, OFFSET) адреса слова ОЗУ, по которым происходит его поиск в и (в случае нахождения, естественно) извлечение из кэш-памяти для трёх различных типов – полностью ассоциативного, множественноассоциативного (с заданным по варианту количеством входов – k) и прямого отображения.

1. Расчёт параметров кэш-памяти начинается прежде всего с определения размера самой кэш-памяти. В рамках задания настоящей практической работы размер кэш-памяти определяется путём деления заданного объёма ОЗУ (в данном случае 8 Гб) на «делитель» кэш-памяти – 256. Примечание: понятие делитель – весьма условное и на практике, как правило не встречается, оно использовано в данном случае только для удобства генерирования вариантов. Он обозначает лишь – «во сколько раз объём кэш-памяти меньше объёма ОЗУ». 

***Для комбинации 388 объём кэш-памяти будет равен: 64 \* 2^30 / 512Mb  = 128Mb.***

***Для комбинации 592 объём кэш-памяти будет равен: 64 \* 2^30 / 1024Mb = 64Mb.***

1. Следующим шагом определим количество бит, необходимых для адресации заданного объёма ОЗУ (т.е. фактически – разрядность шины адреса).

***Для комбинации 388 и 592: ША = Log2(64GB) = 36 бит.***

1. Самым простым параметром из задания, который мы можем определить – это смещение в строке кэш (OFFSET), которое будет одинаковым для всех типов кэш-памяти. В рамках данной работы мы делаем допущение, что адресация в ОЗУ (и следовательно в кэш-памяти) происходит ПОСЛОВНО, и соответственно количество бит смещения будет равным Log2(количество слов с строке кэш). 

***Для комбинации 388: OFFSET = Log2(32) = 5 бит.*** 

***Для комбинации 592: OFFSET = Log2(128) = 7 бит.*** 

Примечание: на самом деле, в разных реализациях кэш-памяти используется как побайтная, так и пословная адресация.

1. Остальные параметры (TAG и SET/INDEX) зависят от конкретного типа кэш-памяти. Параметр TAG вычисляется на самом последнем шаге, а параметры SET/INDEX – по сути представляют собой одно и то же – «номер набора строк» и «номер одной строки» кэш, но для разных типов – k-мерного и прямого отображения, соответственно. В рамках данного ПЗ оба этих параметров будем обозначать одним названием – SET. Прим: так как разрядность шины данных дана в битах, а все вычисления мы производим в байтах, то для определения размера строки в байтах необходимо разделить параметр ШД на 8 бит и умножить на количество слов в строке.

***Для комбинации 388 размер строки в байтах = 128/8 \* 32 = 512 байт.***

***Для комбинации 592 размер строки в байтах = 64/8 \* 128 = 1024 байт.***

1. ` `Для кэш-памяти прямого отображения вычисление параметра SET производится путём деления размера кэш на размер одной её строки и вычисление двоичного логарифма от получившегося количества строк. Примечание: в данном случае за объём строки берётся только объём полезных данных, хранимых в ней. Биты тэга не учитываются. 

***Для комбинации 388 это будет равно: SETk=1 = Log2( 128Mb/512) = 18***

***Для комбинации 592 это будет равно: SETk=1 = Log2( 64Mb/1024) = 16***

1. Для кэш k-мерной ассоциативности вычисление параметра SET производится не для каждой строки, а для набора из k строк, соответственно можно от полученного на предыдущем шаге значения отнять логарифм двоичный от k.

` `***Для комбинации 388 это будет равно: SETk=16 = 18 - Log2(16) = 14***

***Для комбинации 592 это будет равно: SETk=4 = 16 - Log2(4) = 14***

1. ` `Так как в случае полностью ассоциативной кэш-памяти любая строка может располагаться в любом её месте, то параметр SET для неё всегда равен 0 независимо от других параметров.
1. На последнем шаге вычисляется TAG – старшие биты адреса, которые хранятся в кэш-памяти вместе со строкой и по которым непосредственно и производится ассоциативный поиск. Соответственно для вычисления размера поля TAG необходимо отнять от количества бит полного адреса суммарное количество бит уже вычисленных полей – SET и OFFSET. Для рассматриваемого примера это будет: 

1. ` `***Для комбинации 388 в случае k=1 (прямого отображения): TAGk=1 = 36 - 5 - 18 = 13***

` `***Для комбинации 592 в случае k=1 (прямого отображения): TAGk=1 = 36 - 7 - 16 = 13***

1. ` `***Для комбинации 388 в случае k=4 (k- мерной ассоциативности): TAGk=16 = 36 - 5 -14 = 17***

` `***Для комбинации 592 в случае k=4 (k- мерной ассоциативности): TAGk=4 = 36 - 7 - 14 = 15***

1. ` `***Для комбинации 388 в случае k= кол-ву строк (полностью ассоциативный): TAGk= = 36 - 5 - 0 = 31.*** 

` `***Для комбинации 592 в случае k= кол-ву строк (полностью ассоциативный): TAGk= = 36 - 7 - 0 = 29.***

1. Ответы:

***Ответ для комбинации 388:***

|k=1 (прямой доступ)||k=16 (множ.-ассоц.)||<p>k=строк в кэше</p><p>(полностью ассоциативный)</p>|
| :-: | :- | :-: | :- | :-: |
|TAG|SET|OFFSET||TAG|SET|OFFSET||TAG|SET|OFFSET|
|**13**|**18**|**5**||**17**|**14**|**5**||**31**|**0**|**5**|

***Ответ для комбинации 592:***

|k=1 (прямой доступ)||k=4 (множ.-ассоц.)||<p>k=строк в кэше</p><p>(полностью ассоциативный)</p>|
| :-: | :- | :-: | :- | :-: |
|TAG|SET|OFFSET||TAG|SET|OFFSET||TAG|SET|OFFSET|
|**13**|**16**|**7**||**15**|**14**|**7**||**29**|**0**|**7**|

